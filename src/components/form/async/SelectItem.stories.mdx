import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs'
import { action } from '@storybook/addon-actions'
import { Formik } from 'formik'
import * as Yup from 'yup'
import { useEffect, useState } from 'react'
import { IndexType } from '@aboutbits/pagination'
import { SectionContent } from '../../section'
import { Form } from '../Form'
import { NavigationProvider } from '../../navigation'
import { SelectItem } from './SelectItem'

<Meta
  title="Components/Form/SelectItem"
  component={SelectItem}
  decorators={[
    (Story) => {
      const validationSchema = Yup.object().shape({
        user: Yup.string().required('Required'),
      })
      return (
        <Formik
          initialValues={{ user: '' }}
          validateOnChange={true}
          validationSchema={validationSchema}
          onSubmit={(values) => action('onSubmit')(values)}
        >
          <Form>
            <SectionContent>
              <Story />
            </SectionContent>
          </Form>
        </Formik>
      )
    },
  ]}
/>

# SelectItem

The component can be conveniently used to create a reference to another object.

It leverages on [SelectDialog](/docs/components-dialog-selectdialog--default-story) and the package `@aboutbits/react-toolbox`.

```
npm install @aboutbits/react-toolbox
```

export const Template = ({ defaultData, defaultErrorMessage, ...args }) => {
  const [data, setData] = useState(null)
  const [error, setError] = useState(null)
  useEffect(async () => {
    await new Promise((resolve) => setTimeout(resolve, 1500)).then(() => {
      setData(defaultData)
      setError(defaultErrorMessage)
    })
  })
  return (
    <NavigationProvider>
      <SelectItem
        {...args}
        useGetData={() => {
          return {
            data: data,
            error: error,
          }
        }}
      />
    </NavigationProvider>
  )
}

<Canvas>
  <Story
    name="Default"
    args={{
      id: 'user',
      name: 'user',
      label: 'SelectUser',
      placeholder: 'User',
      defaultValue: { id: 0, name: '' },
      dialogTitle: 'Users',
      dialogLabel: 'Users',
      noSearchResults: 'No users available.',
      renderListItem: (item) => item.name,
      renderErrorMessage: (error) => error.message,
      paginationConfig: { indexType: IndexType.ZERO_BASED },
      defaultErrorMessage: null,
      defaultData: {
        items: [
          { id: 1, name: 'John Doe' },
          { id: 2, name: 'Jane Doe' },
        ],
        currentPage: 0,
        perPage: 15,
        total: 0,
      },
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>

### Props

<ArgsTable story="Default" />

### Theme

The SelectItem component shares the styles with the Input component.
For customization of the styles please checkout the [theme section](/docs/components-form-input--default-story#theme) of the Input component.

<Canvas>
  <Story
    name="Error message"
    args={{
      id: 'user',
      name: 'user',
      label: 'SelectUser',
      placeholder: 'User',
      defaultValue: { id: 0, name: '' },
      dialogTitle: 'Users',
      dialogLabel: 'Users',
      noSearchResults: 'No users available.',
      renderListItem: (item) => item.name,
      renderErrorMessage: (error) => error.message,
      paginationConfig: { indexType: IndexType.ZERO_BASED },
      defaultErrorMessage: { message: 'The API could not handle the request!' },
      defaultData: {
        items: [],
        currentPage: 0,
        perPage: 15,
        total: 0,
      },
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>

<Canvas>
  <Story
    name="Empty list"
    args={{
      id: 'user',
      name: 'user',
      label: 'SelectUser',
      placeholder: 'User',
      defaultValue: { id: 0, name: '' },
      dialogTitle: 'Users',
      dialogLabel: 'Users',
      noSearchResults: 'No users available.',
      renderListItem: (item) => item.name,
      renderErrorMessage: (error) => error.message,
      paginationConfig: { indexType: IndexType.ZERO_BASED },
      defaultErrorMessage: null,
      defaultData: {
        items: [],
        currentPage: 0,
        perPage: 15,
        total: 0,
      },
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>
