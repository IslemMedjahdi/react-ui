import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs'
import { action } from '@storybook/addon-actions'
import { Formik } from 'formik'
import * as Yup from 'yup'
import { IndexType } from '@aboutbits/pagination'
import { SectionContent } from '../../section'
import { Form } from '../Form'
import { NavigationProvider } from '../../navigation'
import { SelectItem } from './SelectItem'

<Meta
  title="Components/Form/SelectItem"
  component={SelectItem}
  decorators={[
    (Story) => {
      const validationSchema = Yup.object().shape({
        user: Yup.string().required('Required'),
      })
      return (
        <Formik
          initialValues={{ user: '' }}
          validateOnChange={true}
          validationSchema={validationSchema}
          onSubmit={(values) => action('onSubmit')(values)}
        >
          <Form>
            <SectionContent>
              <Story />
            </SectionContent>
          </Form>
        </Formik>
      )
    },
  ]}
/>

# SelectItem

The component can be conveniently used to create a reference to another object.

It leverages on [SelectDialog](/docs/components-dialog-selectdialog--default-story) and the package `@aboutbits/react-toolbox`.

```
npm install @aboutbits/react-toolbox
```

export const TemplateNormal = ({ ...args }) => {
  const useGetData = ({ query, page, size }) => {
    const data = Array.from(Array(200).keys())
      .map((index) => {
        return {
          id: index,
          name: `User ${index}`,
        }
      })
      .filter((user) => {
        if (query) {
          return user.name.includes(query)
        } else {
          return true
        }
      })
    return {
      data: {
        items: data.slice(page * size, page * size + size),
        currentPage: page,
        perPage: size,
        total: data.length,
      },
      error: null,
    }
  }
  return (
    <NavigationProvider>
      <SelectItem {...args} useGetData={useGetData} />
    </NavigationProvider>
  )
}

<Canvas>
  <Story
    name="Default"
    args={{
      id: 'user',
      name: 'user',
      label: 'SelectUser',
      placeholder: 'User',
      defaultValue: { id: 0, name: '' },
      dialogTitle: 'Users',
      dialogLabel: 'Users',
      noSearchResults: 'No users available.',
      renderListItem: (item) => item.name,
      renderErrorMessage: (error) => error.message,
      paginationConfig: { indexType: IndexType.ZERO_BASED },
    }}
  >
    {TemplateNormal.bind({})}
  </Story>
</Canvas>

### Props

<ArgsTable story="Default" />

### Theme

The SelectItem component shares the styles with the Input component.
For customization of the styles please checkout the [theme section](/docs/components-form-input--default-story#theme) of the Input component.

export const TemplateError = ({ ...args }) => {
  const useGetData = () => {
    return {
      error: {
        message: 'Something went wrong',
      },
    }
  }
  return (
    <NavigationProvider>
      <SelectItem {...args} useGetData={useGetData} />
    </NavigationProvider>
  )
}

<Canvas>
  <Story
    name="Error"
    args={{
      id: 'user',
      name: 'user',
      label: 'SelectUser',
      placeholder: 'User',
      defaultValue: { id: 0, name: '' },
      dialogTitle: 'Users',
      dialogLabel: 'Users',
      noSearchResults: 'No users available.',
      renderListItem: (item) => item.name,
      renderErrorMessage: (error) => error.message,
      paginationConfig: { indexType: IndexType.ZERO_BASED },
    }}
  >
    {TemplateError.bind({})}
  </Story>
</Canvas>

export const TemplateEmpty = ({ ...args }) => {
  const useGetData = () => {
    return {
      data: {
        items: [],
        currentPage: 0,
        perPage: 15,
        total: 0,
      },
      error: null,
    }
  }
  return (
    <NavigationProvider>
      <SelectItem {...args} useGetData={useGetData} />
    </NavigationProvider>
  )
}

<Canvas>
  <Story
    name="Empty list"
    args={{
      id: 'user',
      name: 'user',
      label: 'SelectUser',
      placeholder: 'User',
      defaultValue: { id: 0, name: '' },
      dialogTitle: 'Users',
      dialogLabel: 'Users',
      noSearchResults: 'No users available.',
      renderListItem: (item) => item.name,
      renderErrorMessage: (error) => error.message,
      paginationConfig: { indexType: IndexType.ZERO_BASED },
    }}
  >
    {TemplateEmpty.bind({})}
  </Story>
</Canvas>
