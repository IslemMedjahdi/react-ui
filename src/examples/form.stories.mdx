import { Meta, Story, Canvas } from '@storybook/addon-docs'
import { IntlProvider, useIntl } from 'react-intl'
import { Formik } from 'formik'
import * as Yup from 'yup'
import { DesignSystemProvider } from '../designSystem/DesignSystemProvider'
import { ContentArea } from '../components/content/ContentArea'
import { Form } from '../components/form/Form'
import {
  Section,
  SectionContentTwoColumn,
  SectionHeader,
  SectionTitle,
} from '../components/section'
import { Input } from '../components/form/Input'
import { Select } from '../components/form/Select'
import { Actions } from '../components/action/Action'
import { SubmitButton } from '../components/button/SubmitButton'
import { useTheme } from '../designSystem/theme/ThemeContext'
import enMessages from '../translations/shared.en.json'
import { i18n, locales } from './i18n'

<Meta title="Examples/Form" component={DesignSystemProvider} />

# Form

The following example shows how a potential form could look like.

`formik` is used to handle the form.

As schema validator `yup` is used.

```
npm install yup
```

export const Template = ({ title }) => {
  const intl = useIntl()
  const initialValues = {
    email: 'info@aboutbits.it',
    name: 'John Doe',
    language: 'EN',
    role: 'USER',
  }
  const schema = Yup.object().shape({
    email: Yup.string().email().required(),
    name: Yup.string().required(),
    language: Yup.string().required(),
    role: Yup.string().required(),
  })
  return (
    <DesignSystemProvider theme={useTheme()}>
      <IntlProvider locale="en" messages={enMessages}>
        <ContentArea>
          <Formik
            initialValues={initialValues}
            validationSchema={schema}
            validateOnBlur={true}
            validateOnChange={true}
          >
            <Form>
              <Section>
                <SectionHeader>
                  <SectionTitle>{title}</SectionTitle>
                </SectionHeader>
                <SectionContentTwoColumn>
                  <Input
                    id="name"
                    type="text"
                    autoCapitalize="none"
                    name="name"
                    placeholder={intl.formatMessage({
                      id: 'shared.field.name',
                    })}
                    label={intl.formatMessage({ id: 'shared.field.name' })}
                  />
                  <Input
                    id="email"
                    type="email"
                    autoCapitalize="none"
                    name="email"
                    placeholder={intl.formatMessage({
                      id: 'shared.field.email',
                    })}
                    label={intl.formatMessage({ id: 'shared.field.email' })}
                  />
                  <Select
                    id="language"
                    autoCapitalize="none"
                    name="language"
                    label={intl.formatMessage({ id: 'shared.field.language' })}
                  >
                    {i18n.supportedLanguages.map((supportedLanguage, index) => (
                      <option
                        className="bg-gray-600"
                        key={index}
                        value={supportedLanguage}
                      >
                        {locales[supportedLanguage]}
                      </option>
                    ))}
                  </Select>
                  <Select
                    id="role"
                    autoCapitalize="none"
                    name="role"
                    label="role"
                  >
                    <option className="bg-gray-600" value="ADMIN">
                      Admin
                    </option>
                    <option className="bg-gray-600" value="USER">
                      User
                    </option>
                  </Select>
                </SectionContentTwoColumn>
                <Actions>
                  <SubmitButton>Save changes</SubmitButton>
                </Actions>
              </Section>
            </Form>
          </Formik>
        </ContentArea>
      </IntlProvider>
    </DesignSystemProvider>
  )
}

<Canvas>
  <Story name="Default" args={{ title: 'User edit' }}>
    {Template.bind({})}
  </Story>
</Canvas>

### Components used

- [ContentArea](/docs/components-content-contentarea--default-story):
- [Form](/docs/components-form-form--default-story)
- [Section](/docs/components-section-section--default-story)
- [SectionHeader](/docs/components-section-sectionheader--default-story)
- [SectionTitle](/docs/components-section-sectiontitle--default-story)
- [SectionContentTwoColumn](/docs/components-section-sectioncontenttwocolumn--default-story)
- [Input](/docs/components-form-input--default-story)
- [Select](/docs/components-form-select--default-story)
- [Action](/docs/components-action-actions--default-story)
- [SubmitButton](/docs/components-button-submitbutton--default-story)
